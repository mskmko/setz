<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ãƒƒãƒˆå›³ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆSTAGE PLOT MAKERï¼‰</title>

    <meta property="og:title" content="ã‚»ãƒƒãƒˆå›³ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆSTAGE PLOT MAKERï¼‰">
    <meta property="og:description" content="ãƒãƒ³ãƒ‰ãƒãƒ³å¿…é ˆï¼ã‚¹ãƒãƒ›ã§ã‚»ãƒƒãƒˆå›³ã¨å›ç·šè¡¨ã‚’ã‚µã‚¯ãƒƒã¨ä½œã‚Œã‚‹ç„¡æ–™ãƒ„ãƒ¼ãƒ«ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§å®Œçµã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã€‚">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://github.com/mskmko/setz">
    <meta property="og:image" content="https://github.com/mskmko/setz/ogp-image.png">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overscroll-behavior-y: none;
        }

        /* â˜…è¿½åŠ : ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ«ã®å…¥ã‚Œç‰©ï¼‰ */
        .app-header {
            display: flex;
            align-items: center;
            /* å‚ç›´æ–¹å‘ä¸­å¤®æƒãˆ */
            width: 100%;
            max-width: 600px;
            margin-bottom: 10px;
        }

        /* â˜…è¿½åŠ : ãƒ­ã‚´ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .logo {
            font-size: 2rem;
            font-weight: 900;
            /* ã‹ãªã‚Šå¤ªã */
            color: #cfe5fe;
            letter-spacing: 0.2px;
            margin-right: 15px;
            /* ã‚¿ã‚¤ãƒˆãƒ«ã¨ã®é–“éš” */
            font-style: italic;
            /* å°‘ã—æ–œã‚ã«ã—ã¦ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã‚’ */
        }

        /* â˜…å¤‰æ›´: H1ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå·¦å¯„ã›ã«å¤‰æ›´ãªã©ï¼‰ */
        h1 {
            margin: 0;
            font-size: 1rem;
            color: #888;
            letter-spacing: 1px;
            text-align: left;
            /* å·¦å¯„ã› */
            line-height: 1.3;
            font-weight: normal;
            flex: 1;
            /* æ®‹ã‚Šã®å¹…ã‚’åŸ‹ã‚ã‚‹ */
        }

        input#artist-name {
            font-size: 2rem;
            font-weight: bold;
            background: transparent;
            border: none;
            border-bottom: 2px solid #555;
            color: #fff;
            text-align: center;
            margin: 10px 0 30px 0;
            width: 100%;
            max-width: 600px;
            outline: none;
        }

        input#artist-name::placeholder {
            color: #444;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
        #stage-area {
            width: 90%;
            max-width: 600px;
            aspect-ratio: 3 / 2;
            background-color: #222;
            border: 2px solid #444;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px);
            background-size: 40px 40px;
            margin-bottom: 20px;
            touch-action: none;
        }

        .stage-label {
            position: absolute;
            color: #666;
            font-weight: bold;
            pointer-events: none;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ */
        .gear-item {
            border-radius: 4px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            user-select: none;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 10;
            box-sizing: border-box;
            line-height: 1.1;
            padding: 2px;
            word-break: break-all;
            border: 1px solid #000;
            touch-action: none;
        }

        .gear-item:active {
            cursor: grabbing;
            z-index: 20;
        }

        .gear-item.circle {
            border-radius: 50%;
        }

        /* ãƒ‘ãƒ¬ãƒƒãƒˆã‚¨ãƒªã‚¢ */
        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            max-width: 600px;
        }

        .add-btn {
            padding: 8px 12px;
            background-color: #333;
            color: #ccc;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .add-btn:hover {
            background-color: #555;
            color: white;
        }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢å…±é€š */
        .section-box {
            width: 90%;
            max-width: 600px;
            background: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        /* æ©Ÿæãƒªã‚¹ãƒˆè¡Œ */
        .gear-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            background-color: #2a2a2a;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid transparent;
            transition: background-color 0.2s;
        }

        .gear-row.dragging {
            opacity: 0.5;
            border: 1px dashed #777;
        }

        .drag-handle {
            cursor: move;
            color: #777;
            font-size: 1.2rem;
            padding: 0 5px;
            user-select: none;
        }

        .drag-handle:hover {
            color: #fff;
        }

        /* ã‚¹ãƒãƒ›ç”¨è¨­å®š */
        @media (max-width: 768px) {
            .drag-handle {
                display: none;
            }
        }

        .gear-row span.label {
            width: 90px;
            font-weight: bold;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gear-row input.label-input {
            width: 90px;
            font-weight: bold;
            font-size: 0.8rem;
            background: #222;
            color: #81d4fa;
            border: 1px solid #555;
            padding: 5px;
            margin-right: 0;
            flex: none;
        }

        .gear-row input.label-input:focus {
            background: #333;
            border-color: #81d4fa;
            outline: none;
        }

        .gear-row input.detail-input {
            background: #333;
            border: 1px solid #444;
            color: white;
            padding: 8px;
            border-radius: 4px;
            flex: 1;
        }

        .remove-btn {
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 10px;
            height: 34px;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            height: 300px;
            background: #333;
            border: 1px solid #444;
            color: white;
            padding: 10px;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 10px;
            font-family: inherit;
            line-height: 1.5;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .action-btn {
            padding: 12px 24px;
            font-size: 0.9rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .action-btn:hover {
            opacity: 0.8;
        }

        .btn-print {
            background-color: #2196f3;
            color: white;
        }

        .btn-copy {
            background-color: #4caf50;
            color: white;
        }

        .btn-save-img {
            background-color: #ff9800;
            color: white;
        }

        /* ãƒªãƒ³ã‚¯é›† */
        .link-section {
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .link-section h4 {
            margin: 0 0 15px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .link-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .venue-link {
            display: block;
            background: #222;
            color: #888;
            text-decoration: none;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.8rem;
            transition: 0.2s;
            border: 1px solid #333;
        }

        .venue-link:hover {
            background: #333;
            color: #fff;
            border-color: #555;
        }

        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        footer {
            margin-top: 40px;
            color: #555;
            font-size: 0.8rem;
            text-align: center;
            line-height: 1.6;
        }

        footer a {
            color: #777;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
            color: #999;
        }

        .privacy-note {
            display: block;
            margin-top: 10px;
            color: #444;
            font-size: 0.7rem;
        }

        /* --- å°åˆ·è¨­å®š --- */
        @media print {
            body {
                background-color: white;
                color: black;
                display: block;
            }

            /* â˜…å¤‰æ›´: ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã¯å°åˆ·ã—ãªã„ */
            .app-header,
            .palette,
            .actions,
            .remove-btn,
            .drag-handle,
            .link-section,
            footer {
                display: none;
            }

            #stage-area {
                border: 2px solid black;
                background: white;
                margin: 0 auto 20px auto;
                aspect-ratio: 3 / 2;
                width: 100%;
                max-width: 600px;
            }

            .gear-item {
                border: 1px solid black;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .section-box {
                border: none;
                padding: 0;
                margin-bottom: 20px;
                width: 100%;
                max-width: 100%;
            }

            input,
            textarea {
                border: 1px solid #ccc;
                background: white;
                color: black;
                font-family: "Helvetica Neue", Arial, sans-serif;
            }

            .gear-row input {
                border: none;
                padding: 0;
                margin-left: 5px;
            }

            .gear-row input.label-input {
                font-weight: bold;
                width: auto;
                color: black;
            }

            input#artist-name {
                border-bottom: 2px solid black;
                color: black;
                text-align: center;
            }

            .gear-row {
                background-color: transparent;
                border: none;
                padding: 0;
                margin-bottom: 5px;
            }

            #notes-section {
                break-before: page;
                page-break-before: always;
                margin-top: 20px;
            }
        }

        /* --- ç”»åƒä¿å­˜ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body.screenshot-active {
            background-color: white !important;
            color: black !important;
            width: 800px;
            margin: 0 auto;
            height: auto !important;
            min-height: 100vh !important;
            overflow: visible !important;
        }

        /* â˜…å¤‰æ›´: ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã¯ç”»åƒä¿å­˜æ™‚ã‚‚éš ã™ */
        body.screenshot-active .app-header,
        body.screenshot-active .palette,
        body.screenshot-active .actions,
        body.screenshot-active .remove-btn,
        body.screenshot-active .drag-handle,
        body.screenshot-active .link-section,
        body.screenshot-active footer {
            display: none !important;
        }

        body.screenshot-active #stage-area {
            border: 2px solid black !important;
            background-color: white !important;
            margin: 0 auto 20px auto;
        }

        body.screenshot-active .gear-item {
            border: 1px solid black !important;
        }

        body.screenshot-active .section-box {
            background: transparent !important;
            border: none !important;
            color: black !important;
            padding: 0;
        }

        body.screenshot-active input,
        body.screenshot-active textarea {
            background: white !important;
            color: black !important;
            border: 1px solid #ccc !important;
            padding-top: 4px !important;
            padding-bottom: 4px !important;
            line-height: 1.5 !important;
            height: auto !important;
        }

        body.screenshot-active .gear-row {
            background: transparent !important;
            margin-bottom: 8px !important;
        }

        body.screenshot-active .gear-row input {
            border: none !important;
        }
    </style>
</head>

<body>

    <header class="app-header">
        <div class="logo">Setz</div>
        <h1>ã‚»ãƒƒãƒˆå›³ãƒ¡ãƒ¼ã‚«ãƒ¼<br>ï¼ˆSTAGE PLOT MAKERï¼‰</h1>
    </header>

    <input type="text" id="artist-name" placeholder="BAND NAME (å…¥åŠ›ã—ã¦ãã ã•ã„)">

    <div class="palette">
        <button class="add-btn" onclick="addGear('Member', '#f48fb1', '#000', 40, 40, true)">ğŸ§‘â€ğŸ¤ Member</button>
        <button class="add-btn" onclick="addGear('Dr Set', '#ffca28', '#000', 80, 80)">ğŸ¥ Dr Set</button>
        <button class="add-btn" onclick="addGear('G.Amp', '#e3f2fd', '#000', null, 50)">ğŸ¸ G.Amp</button>
        <button class="add-btn" onclick="addGear('B.Amp', '#0d47a1', '#fff', null, 50)">ğŸ¸ B.Amp</button>
        <button class="add-btn" onclick="addGear('Vo.Mic', '#ef5350', '#000', 40, 40)">ğŸ¤ Vo.Mic</button>
        <button class="add-btn" onclick="addGear('Cho.Mic', '#ef5350', '#000', 40, 40)">ğŸ¤ Cho.Mic</button>
        <button class="add-btn" onclick="addGear('Key', '#66bb6a', '#000', 100, 40)">ğŸ¹ Key</button>
        <button class="add-btn" onclick="addGear('DI', '#26a69a', '#000', 40, 40)">ğŸ›ï¸ DI</button>
        <button class="add-btn" onclick="addGear('Monitor', '#bdbdbd', '#000', null, 30)">ğŸ”Š Monitor</button>
        <button class="add-btn" onclick="addGear('Others', '#9575cd', '#fff', null, 50)">ğŸ“¦ Others</button>
    </div>

    <div id="stage-area">
        <div class="stage-label" style="top: 10px; left: 10px;">SR (ä¸‹æ‰‹)</div>
        <div class="stage-label" style="top: 10px; right: 10px;">SL (ä¸Šæ‰‹)</div>
        <div class="stage-label" style="bottom: 10px; width: 100%; text-align: center; font-size: 1rem;">AUDIENCE</div>
    </div>

    <div class="section-box" id="gear-list-section">
        <h3>ğŸ“‹ æ©Ÿæãƒªã‚¹ãƒˆãƒ»å›ç·šè©³ç´°ãƒ»ãƒ¡ãƒ³ãƒãƒ¼</h3>
        <div id="gear-list">
            <p style="font-size: 0.8rem; color: #777;">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>

    <div class="section-box" id="notes-section">
        <h3>ğŸ“ ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆãƒ»è¦æœ› (Page 2)</h3>
        <textarea id="general-notes" placeholder="ã€ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã€‘
1. 
2. 
3. 
4. 
5. 

ã€ç…§æ˜ãƒ»SEãƒ»ãã®ä»–è¦æœ›ã€‘
ãƒ»ãƒªãƒãƒ¼ã‚µãƒ«å¸Œæœ›æ™‚é–“: 
ãƒ»æŒã¡è¾¼ã¿æ©Ÿæã®è©³ç´°: "></textarea>
    </div>

    <div class="actions">
        <button class="action-btn btn-save-img" onclick="saveAsImage()">ğŸ“· ç”»åƒã¨ã—ã¦ä¿å­˜</button>
        <button class="action-btn btn-print" onclick="window.print()">ğŸ–¨ï¸ PDFä¿å­˜ / å°åˆ·</button>
        <button class="action-btn btn-copy" onclick="copyText()">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="link-section">
        <h4>ğŸ”— ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒã‚¦ã‚¹ æ©Ÿæãƒªã‚¹ãƒˆ (å‚è€ƒ)</h4>
        <div class="link-grid">
            <a href="https://www.loft-prj.co.jp/schedule/shelter/about" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢
                SHELTER</a>
            <a href="https://clubque.net/about/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ CLUB Que</a>
            <a href="https://toos.co.jp/basementbar/equipment/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ BASEMENT BAR</a>
            <a href="https://www.toos.co.jp/3/equipment/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ THREE</a>
            <a href="http://s-era.jp/hall-info" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ ERA</a>
            <a href="https://livehaus.jp/equipment/" target="_blank" class="venue-link">LIVEHAUS</a>
            <a href="https://www.toos.co.jp/lush/" target="_blank" class="venue-link">æ¸‹è°· LUSH</a>
            <a href="https://www.toos.co.jp/home/h_equipment.html" target="_blank" class="venue-link">æ¸‹è°· HOME</a>
            <a href="https://www.shan-gri-la.jp/equip.html" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ Shangri-La</a>
            <a href="http://www.club-upset.com/home/instrument/" target="_blank" class="venue-link">åå¤å±‹ CLUB UPSET</a>
        </div>
    </div>

    <footer>
        Created by <a href="https://twitter.com/mskmko" target="_blank">@mskmko</a> | ã‚»ãƒƒãƒˆå›³ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆSTAGE PLOT MAKERï¼‰<br>
        <span class="privacy-note">â€»ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã™ã¹ã¦å®Œçµã—ã¾ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ãƒ»ä¿å­˜ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
    </footer>

    <script>
        let gearGlobalId = 0;
        const usedNumbersRegistry = {};

        const stageArea = document.getElementById('stage-area');
        const gearList = document.getElementById('gear-list');

        function addGear(baseName, bgColor, textColor, w, h, isCircle = false) {
            if (gearGlobalId === 0) gearList.innerHTML = '';
            gearGlobalId++;
            const elementId = `gear-${gearGlobalId}`;

            if (!usedNumbersRegistry[baseName]) {
                usedNumbersRegistry[baseName] = [];
            }
            const usedList = usedNumbersRegistry[baseName];

            let assignedNum = 1;
            while (usedList.includes(assignedNum)) {
                assignedNum++;
            }
            usedList.push(assignedNum);
            usedList.sort((a, b) => a - b);

            let displayName = baseName;
            if (assignedNum > 1) {
                displayName = `${baseName} (${assignedNum})`;
            }

            const el = document.createElement('div');
            el.classList.add('gear-item');
            if (isCircle) el.classList.add('circle');

            el.id = elementId;
            el.innerText = displayName;
            el.style.backgroundColor = bgColor;
            el.style.color = textColor;

            if (w) el.style.width = w + 'px';
            else el.style.minWidth = '50px';
            if (h) el.style.height = h + 'px';
            else el.style.height = '50px';

            el.style.top = '50%';
            el.style.left = '50%';

            setupDraggable(el);
            stageArea.appendChild(el);

            const row = document.createElement('div');
            row.classList.add('gear-row');
            row.id = `row-${elementId}`;
            row.setAttribute('draggable', 'true');

            row.dataset.basename = baseName;
            row.dataset.assignednum = assignedNum;
            row.dataset.elementid = elementId;

            let nameFieldHtml = '';
            if (baseName === 'Member') {
                nameFieldHtml = `<input type="text" class="label-input" value="${displayName}" oninput="updatePlotLabel('${elementId}', this.value)">`;
            } else {
                nameFieldHtml = `<span class="label">${displayName}</span>`;
            }

            row.innerHTML = `
                <div class="drag-handle">â˜°</div>
                ${nameFieldHtml}
                <input type="text" class="detail-input" placeholder="è©³ç´° (ä¾‹: æŒã¡è¾¼ã¿)">
                <button class="remove-btn" onclick="removeGear(this)">Ã—</button>
            `;

            addDragEvents(row);
            gearList.appendChild(row);
        }

        function updatePlotLabel(elementId, newValue) {
            const plotItem = document.getElementById(elementId);
            if (plotItem) {
                plotItem.innerText = newValue;
            }
        }

        function removeGear(btn) {
            const row = btn.closest('.gear-row');
            const elementId = row.dataset.elementid;
            const baseName = row.dataset.basename;
            const assignedNum = parseInt(row.dataset.assignednum);

            const plotItem = document.getElementById(elementId);
            if (plotItem) plotItem.remove();

            row.remove();

            if (usedNumbersRegistry[baseName]) {
                const index = usedNumbersRegistry[baseName].indexOf(assignedNum);
                if (index > -1) {
                    usedNumbersRegistry[baseName].splice(index, 1);
                }
            }
        }

        function addDragEvents(row) {
            row.addEventListener('dragstart', function (e) {
                row.classList.add('dragging');
            });
            row.addEventListener('dragend', function (e) {
                row.classList.remove('dragging');
            });
            gearList.addEventListener('dragover', function (e) {
                e.preventDefault();
                const draggingItem = document.querySelector('.dragging');
                if (!draggingItem) return;

                const afterElement = getDragAfterElement(gearList, e.clientY);
                if (afterElement == null) {
                    gearList.appendChild(draggingItem);
                } else {
                    gearList.insertBefore(draggingItem, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.gear-row:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function setupDraggable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            elmnt.ontouchstart = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                if (e.type === 'touchstart') {
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                } else {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                }
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                document.ontouchend = closeDragElement;
                document.ontouchmove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                let clientX, clientY;
                if (e.type === 'touchmove') {
                    e.preventDefault();
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    e.preventDefault();
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                pos1 = pos3 - clientX;
                pos2 = pos4 - clientY;
                pos3 = clientX;
                pos4 = clientY;

                let newTop = (elmnt.offsetTop - pos2);
                let newLeft = (elmnt.offsetLeft - pos1);

                if (newTop < 0) newTop = 0;
                if (newLeft < 0) newLeft = 0;
                if (newTop > stageArea.offsetHeight - elmnt.offsetHeight) newTop = stageArea.offsetHeight - elmnt.offsetHeight;
                if (newLeft > stageArea.offsetWidth - elmnt.offsetWidth) newLeft = stageArea.offsetWidth - elmnt.offsetWidth;

                elmnt.style.top = newTop + "px";
                elmnt.style.left = newLeft + "px";
            }

            function closeDragElement() {
                const parentWidth = stageArea.offsetWidth;
                const parentHeight = stageArea.offsetHeight;

                const currentLeft = elmnt.offsetLeft;
                const currentTop = elmnt.offsetTop;

                const leftPercent = (currentLeft / parentWidth) * 100;
                const topPercent = (currentTop / parentHeight) * 100;

                elmnt.style.left = leftPercent + "%";
                elmnt.style.top = topPercent + "%";

                document.onmouseup = null;
                document.onmousemove = null;
                document.ontouchend = null;
                document.ontouchmove = null;
            }
        }

        function copyText() {
            const bandName = document.getElementById('artist-name').value || "ãƒãƒ³ãƒ‰åæœªå…¥åŠ›";
            let text = `ã€${bandName} ã‚¹ãƒ†ãƒ¼ã‚¸å›³ãƒ»å›ç·šè¡¨ã€‘\n\n`;

            const rows = document.querySelectorAll('.gear-row');
            rows.forEach(row => {
                let name = "";
                const spanLabel = row.querySelector('span.label');
                const inputLabel = row.querySelector('input.label-input');

                if (inputLabel) {
                    name = inputLabel.value;
                } else if (spanLabel) {
                    name = spanLabel.innerText;
                }

                const val = row.querySelector('input.detail-input').value;
                if (val) text += `â–  ${name}: ${val}\n`;
            });

            const notes = document.getElementById('general-notes').value;
            if (notes) text += `\nã€ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆãƒ»é€£çµ¡äº‹é …ã€‘\n${notes}`;

            navigator.clipboard.writeText(text).then(() => {
                alert("ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            });
        }

        function saveAsImage() {
            // 1. ãƒãƒ³ãƒ‰åå…¥åŠ›æ¬„ã®å€¤ã‚’å–å¾—
            const nameInput = document.getElementById('artist-name');
            const nameValue = nameInput.value || "BAND NAME";

            // 2. ä¸€æ™‚çš„ãªãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºç”¨DIVã‚’ä½œæˆ
            const textDiv = document.createElement('div');
            textDiv.innerText = nameValue;
            textDiv.id = 'temp-artist-name';
            textDiv.style.cssText = "font-size: 2rem; font-weight: bold; text-align: center; color: black; margin-bottom: 30px; padding-top: 10px; font-family: inherit;";

            // 3. å…¥åŠ›æ¬„ã‚’éš ã—ã¦ã€ãƒ†ã‚­ã‚¹ãƒˆDIVã‚’æŒ¿å…¥
            nameInput.style.display = 'none';
            nameInput.parentNode.insertBefore(textDiv, nameInput);

            window.scrollTo(0, 0);
            document.body.classList.add('screenshot-active');

            setTimeout(() => {
                const bodyHeight = document.body.scrollHeight;

                html2canvas(document.body, {
                    height: bodyHeight,
                    windowHeight: bodyHeight,
                    scrollY: 0,
                    scale: 2,
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'stage_plot.png';
                    link.href = canvas.toDataURL();
                    link.click();

                    // 4. å…ƒã«æˆ»ã™å‡¦ç†
                    document.body.classList.remove('screenshot-active');
                    textDiv.remove();
                    nameInput.style.display = 'block';

                }).catch(err => {
                    alert("ç”»åƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    console.error(err);
                    document.body.classList.remove('screenshot-active');
                    if (textDiv.parentNode) textDiv.remove();
                    nameInput.style.display = 'block';
                });
            }, 500);
        }
    </script>
</body>

</html>
