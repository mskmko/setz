<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STAGE PLOT MAKER (ã™ã¦ã·ã‚)</title>
    <style>
        /* --- åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 1.2rem;
            color: #888;
            letter-spacing: 2px;
        }

        input#artist-name {
            font-size: 2rem;
            font-weight: bold;
            background: transparent;
            border: none;
            border-bottom: 2px solid #555;
            color: #fff;
            text-align: center;
            margin: 10px 0 30px 0;
            width: 100%;
            max-width: 600px;
            outline: none;
        }

        input#artist-name::placeholder {
            color: #444;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
        #stage-area {
            width: 90%;
            max-width: 600px;
            height: 400px;
            background-color: #222;
            border: 2px solid #444;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px);
            background-size: 40px 40px;
            margin-bottom: 20px;
        }

        .stage-label {
            position: absolute;
            color: #666;
            font-weight: bold;
            pointer-events: none;
            font-size: 1.5rem;
            opacity: 0.7;
        }

        /* ã‚¢ã‚¤ã‚³ãƒ³ (æ©Ÿæãƒ»ãƒ¡ãƒ³ãƒãƒ¼) */
        .gear-item {
            border-radius: 4px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            user-select: none;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 10;
            box-sizing: border-box;
            line-height: 1.1;
            padding: 2px;
            word-break: break-all;
            border: 1px solid #000;
        }

        .gear-item:active {
            cursor: grabbing;
            z-index: 20;
        }

        .gear-item.circle {
            border-radius: 50%;
        }

        /* ãƒ‘ãƒ¬ãƒƒãƒˆã‚¨ãƒªã‚¢ */
        .palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            max-width: 600px;
        }

        .add-btn {
            padding: 8px 12px;
            background-color: #333;
            color: #ccc;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .add-btn:hover {
            background-color: #555;
            color: white;
        }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢å…±é€š */
        .section-box {
            width: 90%;
            max-width: 600px;
            background: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        /* æ©Ÿæãƒªã‚¹ãƒˆè¡Œ */
        .gear-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            background-color: #2a2a2a;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid transparent;
            transition: background-color 0.2s;
        }

        .gear-row.dragging {
            opacity: 0.5;
            border: 1px dashed #777;
        }

        .drag-handle {
            cursor: move;
            color: #777;
            font-size: 1.2rem;
            padding: 0 5px;
            user-select: none;
        }

        .drag-handle:hover {
            color: #fff;
        }

        /* ãƒ©ãƒ™ãƒ«ï¼ˆæ©Ÿæåï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .gear-row span.label {
            width: 90px;
            font-weight: bold;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ãƒ¡ãƒ³ãƒãƒ¼åç·¨é›†ç”¨ã®å…¥åŠ›æ¬„ã‚¹ã‚¿ã‚¤ãƒ« */
        .gear-row input.label-input {
            width: 90px;
            font-weight: bold;
            font-size: 0.8rem;
            background: #222;
            /* å°‘ã—æš—ãã—ã¦åŒºåˆ¥ */
            color: #81d4fa;
            /* ç·¨é›†å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™è‰²å‘³ */
            border: 1px solid #555;
            padding: 5px;
            margin-right: 0;
            flex: none;
            /* å¹…ã‚’å›ºå®š */
        }

        .gear-row input.label-input:focus {
            background: #333;
            border-color: #81d4fa;
            outline: none;
        }

        /* è©³ç´°å…¥åŠ›æ¬„ */
        .gear-row input.detail-input {
            background: #333;
            border: 1px solid #444;
            color: white;
            padding: 8px;
            border-radius: 4px;
            flex: 1;
        }

        .remove-btn {
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 10px;
            height: 34px;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            height: 300px;
            background: #333;
            border: 1px solid #444;
            color: white;
            padding: 10px;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 10px;
            font-family: inherit;
            line-height: 1.5;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .actions {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
        }

        .action-btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .action-btn:hover {
            opacity: 0.8;
        }

        .btn-print {
            background-color: #2196f3;
            color: white;
        }

        .btn-copy {
            background-color: #4caf50;
            color: white;
        }

        /* ãƒªãƒ³ã‚¯é›†ã‚¨ãƒªã‚¢ */
        .link-section {
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .link-section h4 {
            margin: 0 0 15px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .link-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .venue-link {
            display: block;
            background: #222;
            color: #888;
            text-decoration: none;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.8rem;
            transition: 0.2s;
            border: 1px solid #333;
        }

        .venue-link:hover {
            background: #333;
            color: #fff;
            border-color: #555;
        }

        footer {
            margin-top: 40px;
            color: #555;
            font-size: 0.8rem;
            text-align: center;
        }

        footer a {
            color: #777;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
            color: #999;
        }

        /* --- å°åˆ·è¨­å®š --- */
        @media print {
            body {
                background-color: white;
                color: black;
                display: block;
            }

            .palette,
            .actions,
            .remove-btn,
            .drag-handle,
            .link-section,
            footer {
                display: none;
            }

            #stage-area {
                border: 2px solid black;
                background: white;
                margin: 0 auto 20px auto;
            }

            .gear-item {
                border: 1px solid black;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .section-box {
                border: none;
                padding: 0;
                margin-bottom: 20px;
                width: 100%;
                max-width: 100%;
            }

            input,
            textarea {
                border: 1px solid #ccc;
                background: white;
                color: black;
                font-family: "Helvetica Neue", Arial, sans-serif;
            }

            /* å°åˆ·æ™‚ã€å…¥åŠ›æ¬„ã®æ ç·šã‚’æ¶ˆã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã£ã½ãè¦‹ã›ã‚‹èª¿æ•´ */
            .gear-row input {
                border: none;
                padding: 0;
                margin-left: 5px;
            }

            .gear-row input.label-input {
                font-weight: bold;
                width: auto;
                color: black;
            }

            input#artist-name {
                border-bottom: 2px solid black;
                color: black;
                text-align: center;
            }

            .gear-row {
                background-color: transparent;
                border: none;
                padding: 0;
                margin-bottom: 5px;
            }

            #notes-section {
                break-before: page;
                page-break-before: always;
                margin-top: 20px;
            }
        }
    </style>
</head>

<body>

    <h1>STAGE PLOT MAKER (ã™ã¦ã·ã‚)</h1>
    <input type="text" id="artist-name" placeholder="BAND NAME (å…¥åŠ›ã—ã¦ãã ã•ã„)">

    <div class="palette">
        <button class="add-btn" onclick="addGear('Member', '#f48fb1', '#000', 40, 40, true)">ğŸ§‘â€ğŸ¤ Member</button>
        <button class="add-btn" onclick="addGear('Dr Set', '#ffca28', '#000', 80, 80)">ğŸ¥ Dr Set</button>
        <button class="add-btn" onclick="addGear('G.Amp', '#e3f2fd', '#000', null, 50)">ğŸ¸ G.Amp</button>
        <button class="add-btn" onclick="addGear('B.Amp', '#0d47a1', '#fff', null, 50)">ğŸ¸ B.Amp</button>
        <button class="add-btn" onclick="addGear('Vo.Mic', '#ef5350', '#000', 40, 40)">ğŸ¤ Vo.Mic</button>
        <button class="add-btn" onclick="addGear('Cho.Mic', '#ef5350', '#000', 40, 40)">ğŸ¤ Cho.Mic</button>
        <button class="add-btn" onclick="addGear('Key', '#66bb6a', '#000', 100, 40)">ğŸ¹ Key</button>
        <button class="add-btn" onclick="addGear('DI', '#26a69a', '#000', 40, 40)">ğŸ›ï¸ DI</button>
        <button class="add-btn" onclick="addGear('Monitor', '#bdbdbd', '#000', null, 30)">ğŸ”Š Monitor</button>
        <button class="add-btn" onclick="addGear('Others', '#9575cd', '#fff', null, 50)">ğŸ“¦ Others</button>
    </div>

    <div id="stage-area">
        <div class="stage-label" style="top: 10px; left: 10px;">SR (ä¸‹æ‰‹)</div>
        <div class="stage-label" style="top: 10px; right: 10px;">SL (ä¸Šæ‰‹)</div>
        <div class="stage-label" style="bottom: 10px; width: 100%; text-align: center; font-size: 1rem;">AUDIENCE</div>
    </div>

    <div class="section-box" id="gear-list-section">
        <h3>ğŸ“‹ æ©Ÿæãƒªã‚¹ãƒˆãƒ»å›ç·šè©³ç´°ãƒ»ãƒ¡ãƒ³ãƒãƒ¼</h3>
        <div id="gear-list">
            <p style="font-size: 0.8rem; color: #777;">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>

    <div class="section-box" id="notes-section">
        <h3>ğŸ“ ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆãƒ»è¦æœ› (Page 2)</h3>
        <textarea id="general-notes" placeholder="ã€ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆã€‘
1. 
2. 
3. 
4. 
5. 

ã€ç…§æ˜ãƒ»SEãƒ»ãã®ä»–è¦æœ›ã€‘
ãƒ»ãƒªãƒãƒ¼ã‚µãƒ«å¸Œæœ›æ™‚é–“: 
ãƒ»æŒã¡è¾¼ã¿æ©Ÿæã®è©³ç´°: "></textarea>
    </div>

    <div class="actions">
        <button class="action-btn btn-print" onclick="window.print()">ğŸ–¨ï¸ ç”»åƒä¿å­˜ / å°åˆ·</button>
        <button class="action-btn btn-copy" onclick="copyText()">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="link-section">
        <h4>ğŸ”— ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒã‚¦ã‚¹ æ©Ÿæãƒªã‚¹ãƒˆ (å‚è€ƒ)</h4>
        <div class="link-grid">
            <a href="https://www.loft-prj.co.jp/schedule/shelter/about" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢
                SHELTER</a>
            <a href="https://clubque.net/about/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ CLUB Que</a>
            <a href="https://toos.co.jp/basementbar/equipment/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ BASEMENT BAR</a>
            <a href="https://www.toos.co.jp/3/equipment/" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ THREE</a>
            <a href="http://s-era.jp/hall-info" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ ERA</a>
            <a href="https://livehaus.jp/equipment/" target="_blank" class="venue-link">LIVEHAUS</a>
            <a href="https://www.toos.co.jp/lush/" target="_blank" class="venue-link">æ¸‹è°· LUSH</a>
            <a href="https://www.toos.co.jp/home/h_equipment.html" target="_blank" class="venue-link">æ¸‹è°· HOME</a>
            <a href="https://www.shan-gri-la.jp/equip.html" target="_blank" class="venue-link">ä¸‹åŒ—æ²¢ Shangri-La</a>
            <a href="http://www.club-upset.com/home/instrument/" target="_blank" class="venue-link">åå¤å±‹ CLUB UPSET</a>
        </div>
    </div>

    <footer>
        Created by <a href="https://twitter.com/YOUR_ACCOUNT_HERE" target="_blank">@YourName</a> | STAGE PLOT MAKER
        (ã™ã¦ã·ã‚)
    </footer>

    <script>
        let gearGlobalId = 0;
        const usedNumbersRegistry = {};

        const stageArea = document.getElementById('stage-area');
        const gearList = document.getElementById('gear-list');

        // --- æ©Ÿæè¿½åŠ é–¢æ•° ---
        function addGear(baseName, bgColor, textColor, w, h, isCircle = false) {
            if (gearGlobalId === 0) gearList.innerHTML = '';
            gearGlobalId++;
            const elementId = `gear-${gearGlobalId}`;

            // ç•ªå·æ±ºå®šãƒ­ã‚¸ãƒƒã‚¯
            if (!usedNumbersRegistry[baseName]) {
                usedNumbersRegistry[baseName] = [];
            }
            const usedList = usedNumbersRegistry[baseName];

            let assignedNum = 1;
            while (usedList.includes(assignedNum)) {
                assignedNum++;
            }
            usedList.push(assignedNum);
            usedList.sort((a, b) => a - b);

            let displayName = baseName;
            if (assignedNum > 1) {
                displayName = `${baseName} (${assignedNum})`;
            }

            // --- 1. ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã®ã‚¢ã‚¤ã‚³ãƒ³ä½œæˆ ---
            const el = document.createElement('div');
            el.classList.add('gear-item');
            if (isCircle) el.classList.add('circle');

            el.id = elementId;
            el.innerText = displayName;
            el.style.backgroundColor = bgColor;
            el.style.color = textColor;

            if (w) el.style.width = w + 'px';
            else el.style.minWidth = '50px';
            if (h) el.style.height = h + 'px';
            else el.style.height = '50px';

            el.style.top = '50%';
            el.style.left = '50%';

            setupDraggable(el);
            stageArea.appendChild(el);

            // --- 2. ãƒªã‚¹ãƒˆå…¥åŠ›æ¬„ã®ä½œæˆ ---
            const row = document.createElement('div');
            row.classList.add('gear-row');
            row.id = `row-${elementId}`;
            row.setAttribute('draggable', 'true');

            row.dataset.basename = baseName;
            row.dataset.assignednum = assignedNum;
            row.dataset.elementid = elementId;

            // â˜… ã“ã“ãŒå¤‰æ›´ç‚¹: Memberãªã‚‰Inputã€ãã‚Œä»¥å¤–ã¯Span
            let nameFieldHtml = '';
            if (baseName === 'Member') {
                // ãƒ¡ãƒ³ãƒãƒ¼åç·¨é›†ç”¨å…¥åŠ›æ¬„ (oninputã§ãƒ—ãƒ­ãƒƒãƒˆå´ã®æ–‡å­—ã‚’æ›´æ–°)
                nameFieldHtml = `<input type="text" class="label-input" value="${displayName}" oninput="updatePlotLabel('${elementId}', this.value)">`;
            } else {
                // é€šå¸¸ã®å›ºå®šãƒ©ãƒ™ãƒ«
                nameFieldHtml = `<span class="label">${displayName}</span>`;
            }

            row.innerHTML = `
                <div class="drag-handle">â˜°</div>
                ${nameFieldHtml}
                <input type="text" class="detail-input" placeholder="è©³ç´° (ä¾‹: æŒã¡è¾¼ã¿)">
                <button class="remove-btn" onclick="removeGear(this)">Ã—</button>
            `;

            addDragEvents(row);
            gearList.appendChild(row);
        }

        // --- ãƒ¡ãƒ³ãƒãƒ¼åå¤‰æ›´æ™‚ã«ãƒ—ãƒ­ãƒƒãƒˆã¸åæ˜  ---
        function updatePlotLabel(elementId, newValue) {
            const plotItem = document.getElementById(elementId);
            if (plotItem) {
                plotItem.innerText = newValue;
            }
        }

        // --- æ©Ÿæå‰Šé™¤é–¢æ•° ---
        function removeGear(btn) {
            const row = btn.closest('.gear-row');
            const elementId = row.dataset.elementid;
            const baseName = row.dataset.basename;
            const assignedNum = parseInt(row.dataset.assignednum);

            const plotItem = document.getElementById(elementId);
            if (plotItem) plotItem.remove();

            row.remove();

            if (usedNumbersRegistry[baseName]) {
                const index = usedNumbersRegistry[baseName].indexOf(assignedNum);
                if (index > -1) {
                    usedNumbersRegistry[baseName].splice(index, 1);
                }
            }
        }

        // --- ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ä¸¦ã³æ›¿ãˆ ---
        function addDragEvents(row) {
            row.addEventListener('dragstart', function (e) {
                row.classList.add('dragging');
            });
            row.addEventListener('dragend', function (e) {
                row.classList.remove('dragging');
            });
            gearList.addEventListener('dragover', function (e) {
                e.preventDefault();
                const draggingItem = document.querySelector('.dragging');
                if (!draggingItem) return;

                const afterElement = getDragAfterElement(gearList, e.clientY);
                if (afterElement == null) {
                    gearList.appendChild(draggingItem);
                } else {
                    gearList.insertBefore(draggingItem, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.gear-row:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // --- ãƒ—ãƒ­ãƒƒãƒˆä¸Šã®ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ ---
        function setupDraggable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            elmnt.ontouchstart = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                if (e.type === 'touchstart') {
                    pos3 = e.touches[0].clientX;
                    pos4 = e.touches[0].clientY;
                } else {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                }
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
                document.ontouchend = closeDragElement;
                document.ontouchmove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                let clientX, clientY;
                if (e.type === 'touchmove') {
                    e.preventDefault();
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    e.preventDefault();
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                pos1 = pos3 - clientX;
                pos2 = pos4 - clientY;
                pos3 = clientX;
                pos4 = clientY;

                let newTop = (elmnt.offsetTop - pos2);
                let newLeft = (elmnt.offsetLeft - pos1);

                if (newTop < 0) newTop = 0;
                if (newLeft < 0) newLeft = 0;
                if (newTop > stageArea.offsetHeight - elmnt.offsetHeight) newTop = stageArea.offsetHeight - elmnt.offsetHeight;
                if (newLeft > stageArea.offsetWidth - elmnt.offsetWidth) newLeft = stageArea.offsetWidth - elmnt.offsetWidth;

                elmnt.style.top = newTop + "px";
                elmnt.style.left = newLeft + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
                document.ontouchend = null;
                document.ontouchmove = null;
            }
        }

        // --- ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
        function copyText() {
            const bandName = document.getElementById('artist-name').value || "ãƒãƒ³ãƒ‰åæœªå…¥åŠ›";
            let text = `ã€${bandName} ã‚¹ãƒ†ãƒ¼ã‚¸å›³ãƒ»å›ç·šè¡¨ã€‘\n\n`;

            const rows = document.querySelectorAll('.gear-row');
            rows.forEach(row => {
                // Memberã®å ´åˆã¯inputã‹ã‚‰ã€ãã‚Œä»¥å¤–ã¯spanã‹ã‚‰åå‰ã‚’å–å¾—
                let name = "";
                const spanLabel = row.querySelector('span.label');
                const inputLabel = row.querySelector('input.label-input');

                if (inputLabel) {
                    name = inputLabel.value; // ç·¨é›†ã•ã‚ŒãŸåå‰
                } else if (spanLabel) {
                    name = spanLabel.innerText; // å›ºå®šãƒ©ãƒ™ãƒ«
                }

                const val = row.querySelector('input.detail-input').value;
                if (val) text += `â–  ${name}: ${val}\n`;
            });

            const notes = document.getElementById('general-notes').value;
            if (notes) text += `\nã€ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆãƒ»é€£çµ¡äº‹é …ã€‘\n${notes}`;

            navigator.clipboard.writeText(text).then(() => {
                alert("ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            });
        }
    </script>
</body>

</html>
